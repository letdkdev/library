<!doctype html>
<html lang="en" data-bs-theme="auto">

<head>
    <script src="../assets/js/color-modes.js"></script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.111.3">
    <title>book list</title>


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
          crossorigin="anonymous">


    <link rel="stylesheet" href="//cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">



    <style>
        .btn-delete {

            /*background-color:goldenrod !important;*/
        }
    </style>

</head>

<body>


<div style="background-color: cornflowerblue; height: 3.5rem;">
    <h3 style="padding-left: 1rem; line-height: 3.5rem;">「도서관리 PJT」</h3>
</div>

<div class="container-fluid">
    <div class="row">


        <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-body-tertiary sidebar collapse">
            <div class="position-sticky pt-3 sidebar-sticky">
                <ul class="nav flex-column">

                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page"
                           href="/user">
                            <span data-feather="home" class="align-text-bottom"></span>
                            회원 main
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page"
                           href="/user/user_add">
                            <span data-feather="home" class="align-text-bottom"></span>
                            &nbsp;&nbsp;회원 등록
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page"
                           href="/user/list">
                            <span data-feather="home" class="align-text-bottom"></span>
                            &nbsp;&nbsp;회원 목록
                        </a>
                    </li>


                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page"
                           href="/book">
                            <span data-feather="home" class="align-text-bottom"></span>
                            도서 main
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page"
                           href="/book/book_add">
                            <span data-feather="home" class="align-text-bottom"></span>
                            &nbsp;&nbsp;도서 등록
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page"
                           href="/book/list">
                            <span data-feather="home" class="align-text-bottom"></span>
                            &nbsp;&nbsp;도서 목록
                        </a>
                    </li>


                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page"
                           href="/book">
                            <span data-feather="home" class="align-text-bottom"></span>
                            도서 대여 main
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page"
                           href="/book/list">
                            <span data-feather="home" class="align-text-bottom"></span>
                            &nbsp;&nbsp;도서 대여
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page"
                           href="/book/list">
                            <span data-feather="home" class="align-text-bottom"></span>
                            &nbsp;&nbsp;도서 반납
                        </a>
                    </li>

                </ul>


            </div>
        </nav>


        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">도서 목록</h1>
            </div>

            <table id="myTable">

                <!-- table 요소 내,,전체 삭제 ==>> why) $('#myTable').DataTable(~ ~)에서 생성 가능 -->
            </table>
        </main>

        <form action="/book/update" method="post" id="_frm">
            <input type="hidden" name="book_no" id="_book_no">
            <input type="hidden" name="type" id="_type">
        </form>
    </div>
</div>

<div class="modal hide fade" tabindex="-1" role="dialog" id="modal_edit">
    <div class="modal-dialog" role="document">
        <div class="modal-content rounded-5 shadow">

            <div class="modal-header p-5 pb-4 border-bottom-0">
                <!-- <h5 class="modal-title">Modal title</h5> -->
                <h2 class="fw-bold mb-0">도서 정보 수정</h2>

                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body p-5 pt-0">
                <form class="">


                </form>
            </div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE"
        crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js" integrity="sha384-gdQErvCNWvHQZj6XZM0dNsAoY4v+j5P1XDpNkcM3HJG1Yx04ecqIHk7+4VBOCHOG" crossorigin="anonymous"></script>

<script src="dashboard.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.js"></script>

<script src="//cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

<script>
    function login_check() {

        $.ajax({
            method: "POST",
            url: "/rest_user/login_check",
            cache: false,

            dataType : "json",

            beforeSend: function( xhr ) {
                xhr.overrideMimeType( "text/plain; charset=utf8");
            }
        }).done(function( result ) {
            /* seccess와 동일 */

            if(!result.status){

                location.href = "/sign_in/index.html";

            }

        }).fail(function(data, textStatus, errorThrown){

            location.href = "/sign_in/index.html";

            // alert( "로그인에 실패하였습니다\n계정을 다시 확인해주세요",);
        });
    }

    $(document).ready(
        function () {

            login_check();

            $('#myTable').DataTable(

                {
                    "processing": true,
                    "serverSide": true,
                    "searching":false,
                    "ajax": {
                        "url": "/rest_book/list",
                        dataType: "json",
                        contentType: 'application/json',
                        "type": "POST"
                    },

                    "columns": [
                        { "data": "book_no", "title": "도서 번호" },
                        { "data": "name", "title": "도서 이름" },
                        { "data": "writer", "title": "저자" },
                        { "data": "publication_dt", "title": "출판일자" },
                        { "data": "price", "title": "가격" },
                        { "data": "button", "title": "버튼" }

                           /*
                             book >> list.html의,,
                             data table의,,
                             title이 됨!!
                           */
                    ]
                }
            );

            $('.btn_edit').on("click", function () {

                $('#modal_edit').modal('show');
            })
        }
    );



    function book_return(book_no) {

        $('#_frm').attr("action", "/book/return");

        $('#_book_no').val(book_no);

        $('#_frm').submit();
    }

    function book_lend(book_no) {

        $('#_frm').attr("action", "/book/lend");

        $('#_book_no').val(book_no);

        $('#_frm').submit();

    }

    function update_book(book_no, type) {

        $('#_book_no').val(book_no);

        $('#_type').val(type);

        if (confirm("정말 " + (type == "U" ? "수정" : "삭제") + "하시겠습니까?")) {

            if (type == 'U') {

                let th_arr = ["book_no", "name", "writer", "publication_dt", "price"];

                $('#modal_edit').modal('show');

                let idx = 0;

                $('#modal_edit form').html("");

                $('#modal_edit form').attr({"method": "POST", "action": "/book/update_process"});

                $("#edit_" + book_no).parent().parent().find('td').each(function () {
                        /*
                              td 요소가 여러 개인데,,
                              -----------------------------
                              each(function() {~ ~})에 의해,,
                              순서대로 하나씩,,
                              처리되는 것임!!
                            */

                        let td = $(this);

                        // if(idx <= th_arr.length) {
                        if (idx < th_arr.length) {

                            $('#modal_edit form').append(
                                "<div class=\"form-floating mb-3\">" +

                                "<input type=\"text\" " + (th_arr[idx] == "book_no" ? "readonly" : "") + " class=\"form-control rounded-3\" id=\"floatingInput\" placeholder=\" " + th_arr[idx] + " \" name=\"" + th_arr[idx] + "\" value='" + td.text() + "'>" +

                                "<label for=\"floatingInput\">" + th_arr[idx] + "</label>" +

                                "</div>"
                            );

                            idx++;
                        }
                    }
                );

                $("#modal_edit form").append("<button class=\"w-100 mb-2 btn btn-lg rounded-4 btn-primary\" type=\"submit\">수정</button>");

            } else {

                $('#_type').val('D');

                $('#_frm').submit();

            }

        }
    }


</script>